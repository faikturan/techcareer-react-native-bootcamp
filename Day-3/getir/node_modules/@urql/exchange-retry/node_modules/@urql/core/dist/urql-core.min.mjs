import{visit as e,Kind as r,print as t}from"graphql";import{k as n,s as o,C as s,m as u,a as c,b as l,c as y,d,e as p,g as k,f as v}from"./65a0ab98.min.mjs";export{C as CombinedError,f as createRequest,j as getOperationName,a as makeErrorResult,m as makeResult,i as mergeResultPatch,h as stringifyVariables}from"./65a0ab98.min.mjs";import{subscribe as x,share as w,map as b,filter as q,tap as g,merge as O,mergeMap as _,takeUntil as P,make as S,onPush as E,makeSubject as N,onEnd as R,onStart as M,publish as D,take as A,switchMap as Q,fromValue as F}from"wonka";var I=(e,r)=>{if(Array.isArray(e))for(var t of e)I(t,r);else if("object"==typeof e&&null!==e)for(var n in e)"__typename"===n&&"string"==typeof e[n]?r.add(e[n]):I(e[n],r);return r},L=e=>{if(!e.selectionSet)return e;for(var t of e.selectionSet.selections)if(t.kind===r.FIELD&&"__typename"===t.name.value&&!t.alias)return e;return{...e,selectionSet:{...e.selectionSet,selections:[...e.selectionSet.selections,{kind:r.FIELD,name:{kind:r.NAME,value:"__typename"}}]}}},T=new Map,J=r=>{var t=n(r),a=T.get(t.__key);return a||(a=e(t,{Field:L,InlineFragment:L}),Object.defineProperty(a,"__key",{value:t.__key,enumerable:!1}),T.set(t.__key,a)),a},G=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>G(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=G(e[n]);return t}return e}return e};function U(e){return e.toPromise=()=>new Promise((r=>{var t=x((e=>{e.stale||e.hasNext||Promise.resolve().then((()=>{t.unsubscribe(),r(e)}))}))(e)})),e}function V(e,r,t){return t||(t=r.context),{key:r.key,query:r.query,variables:r.variables,kind:e,context:t}}var W=(e,r)=>V(e.kind,e,{...e.context,meta:{...e.context.meta,...r}}),$=()=>{},z=(e,t,n)=>{for(var a of n)if(a.kind===r.FRAGMENT_DEFINITION){var i=a.name.value,s=o(a);e.has(i)||(e.set(i,s),t.push(a))}else t.push(a)};function B(){for(var e=new Map,t=[],a=[],o=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",i=1;i<arguments.length;i++){var s=arguments[i];s&&s.definitions?a.push(...s.definitions):o+=s,o+=arguments[0][i]}return z(e,t,n(o).definitions),z(e,t,a),n({kind:r.DOCUMENT,definitions:t})}var H=({kind:e})=>"mutation"!==e&&"query"!==e,K=({forward:e,client:r})=>{var t=new Map,n=new Map,a=e=>{var r=V(e.kind,e);return r.query=J(e.query),r},o=e=>{var{key:r,kind:n,context:{requestPolicy:a}}=e;return"query"===n&&"network-only"!==a&&("cache-only"===a||t.has(r))};return i=>{var s=w(i),u=b((e=>{var n=t.get(e.key),a={...n,operation:W(e,{cacheOutcome:n?"hit":"miss"})};return"cache-and-network"===e.context.requestPolicy&&(a.stale=!0,X(r,e)),a}))(q((e=>!H(e)&&o(e)))(s)),c=g((e=>{var{operation:a}=e;if(a){var o=(e=>[...I(e,new Set)])(e.data).concat(a.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var i=new Set,s=0;s<o.length;s++){var u=o[s],c=n.get(u);for(var l of(c||n.set(u,c=new Set),c.values()))i.add(l);c.clear()}for(var y of i.values())t.has(y)&&(a=t.get(y).operation,t.delete(y),X(r,a))}else if("query"===a.kind&&e.data){t.set(a.key,e);for(var d=0;d<o.length;d++){var p=o[d],k=n.get(p);k||n.set(p,k=new Set),k.add(a.key)}}}}))(e(q((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(b((e=>W(e,{cacheOutcome:"miss"})))(O([b(a)(q((e=>!H(e)&&!o(e)))(s)),q((e=>H(e)))(s)])))));return O([u,c])}},X=(e,r)=>e.reexecuteOperation(V(r.kind,r,{...r.context,requestPolicy:"network-only"})),Y=new Set,Z=(e={})=>{var r=!!e.staleWhileRevalidate,t=!!e.includeExtensions,n={},a=[],o=e=>{a.push(e.operation.key),1===a.length&&Promise.resolve().then((()=>{for(var e;e=a.shift();)n[e]=null}))},i=({client:a,forward:i})=>u=>{var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!a.suspense,l=w(u),y=i(q((e=>!n[e.key]||!!n[e.key].hasNext||"network-only"===e.context.requestPolicy))(l)),d=b((e=>{var o=((e,r,t)=>({operation:e,data:r.data?JSON.parse(r.data):void 0,extensions:t&&r.extensions?JSON.parse(r.extensions):void 0,error:r.error?new s({networkError:r.error.networkError?new Error(r.error.networkError):void 0,graphQLErrors:r.error.graphQLErrors}):void 0,hasNext:r.hasNext}))(e,n[e.key],t);return r&&!Y.has(e.key)&&(o.stale=!0,Y.add(e.key),X(a,e)),o}))(q((e=>!!n[e.key]&&"network-only"!==e.context.requestPolicy))(l));return c?d=g(o)(d):y=g((e=>{var{operation:r}=e;if("mutation"!==r.kind){var a=(({hasNext:e,data:r,extensions:t,error:n},a)=>{var o={};return void 0!==r&&(o.data=JSON.stringify(r)),a&&void 0!==t&&(o.extensions=JSON.stringify(t)),e&&(o.hasNext=!0),n&&(o.error={graphQLErrors:n.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},n.networkError&&(o.error.networkError=""+n.networkError)),o})(e,t);n[r.key]=a}}))(y),O([y,d])};return i.restoreData=e=>{for(var r in e)null!==n[r]&&(n[r]=e[r])},i.extractData=()=>{var e={};for(var r in n)null!=n[r]&&(e[r]=n[r]);return e},e&&e.initialState&&i.restoreData(e.initialState),i},ee=({forwardSubscription:e,enableAllOperations:r,isSubscriptionOperation:n})=>({client:a,forward:o})=>{var i=n||(e=>{var{kind:t}=e;return"subscription"===t||!!r&&("query"===t||"mutation"===t)});return r=>{var n=w(r),s=_((r=>{var{key:o}=r,i=q((e=>"teardown"===e.kind&&e.key===o))(n);return P(i)((r=>{var n=e({key:r.key.toString(36),query:t(r.query),variables:r.variables,context:{...r.context}});return S((({next:e,complete:t})=>{var o,i=!1;return Promise.resolve().then((()=>{i||(o=n.subscribe({next:t=>e(u(r,t)),error:t=>e(c(r,t)),complete:()=>{i||(i=!0,"subscription"===r.kind&&a.reexecuteOperation(V("teardown",r,r.context)),t())}}))})),()=>{i=!0,o&&o.unsubscribe()}}))})(r))}))(q(i)(n)),l=o(q((e=>!i(e)))(n));return O([s,l])}},re=({forward:e})=>r=>e(r),te=({forward:e})=>{var r=new Set,t=e=>{var{key:t,kind:n}=e;if("teardown"===n||"mutation"===n)return r.delete(t),!0;var a=r.has(t);return r.add(t),!a},n=({operation:e,hasNext:t})=>{t||r.delete(e.key)};return r=>{var a=q(t)(r);return g(n)(e(a))}},ne=({forward:e})=>r=>{var t=w(r),n=_((e=>{var{key:r}=e,n=l(e),a=y(e,n),o=d(e,n);return P(q((e=>"teardown"===e.kind&&e.key===r))(t))(p(e,a,o))}))(q((e=>"query"===e.kind||"mutation"===e.kind))(t)),a=e(q((e=>"query"!==e.kind&&"mutation"!==e.kind))(t));return O([n,a])},ae=({})=>e=>q((()=>!1))(g((e=>{}))(e)),oe=ae({dispatchDebug:$}),ie=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:e,dispatchDebug(e){}})),t),se=({onError:e})=>({forward:r})=>t=>g((({error:r,operation:t})=>{r&&e(r,t)}))(r(t)),ue=[te,K,ne],ce=function e(r){var t=0,n=new Map,a=new Map,o=[],i={url:r.url,fetchOptions:r.fetchOptions,fetch:r.fetch,preferGetMethod:!!r.preferGetMethod,requestPolicy:r.requestPolicy||"cache-first"},{source:s,next:u}=N(),c=!1;function l(e){if(e&&u(e),!c){for(c=!0;c&&(e=o.shift());)u(e);c=!1}}var y=e=>{var t=q((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(h);return r.maskTypename&&(t=b((e=>({...e,data:G(e.data,!0)})))(t)),"mutation"===e.kind?A(1)(M((()=>u(e)))(t)):w(R((()=>{n.delete(e.key),a.delete(e.key);for(var r=o.length-1;r>=0;r--)o[r].key===e.key&&o.splice(r,1);u(V("teardown",e,e.context))}))(E((r=>{n.set(e.key,r)}))(Q((r=>"query"!==e.kind||r.stale?F(r):O([F(r),b((()=>({...r,stale:!0})))(A(1)(q((r=>"query"===r.kind&&r.key===e.key&&"cache-only"!==r.context.requestPolicy))(s)))])))(P(q((r=>"teardown"===r.kind&&r.key===e.key))(s))(t)))))},d=this instanceof e?this:Object.create(e.prototype),p=Object.assign(d,{suspense:!!r.suspense,operations$:s,reexecuteOperation(e){("mutation"===e.kind||a.has(e.key))&&(o.push(e),Promise.resolve().then(l))},createRequestOperation:(e,r,n)=>(n||(n={}),k(r.query),V(e,r,{_instance:"mutation"===e?t=t+1|0:void 0,...i,...n,requestPolicy:n.requestPolicy||i.requestPolicy,suspense:n.suspense||!1!==n.suspense&&p.suspense})),executeRequestOperation:e=>"mutation"===e.kind?y(e):S((r=>{var t=a.get(e.key);t||a.set(e.key,t=y(e));var o="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return x(r.next)(R((()=>{c=!1,r.complete()}))(M((()=>{var t=n.get(e.key);if("subscription"===e.kind)return l(e);o&&l(e),null!=t&&t===n.get(e.key)?r.next(o?{...t,stale:!0}:t):o||l(e)}))(t))).unsubscribe})),executeQuery(e,r){var t=p.createRequestOperation("query",e,r);return p.executeRequestOperation(t)},executeSubscription(e,r){var t=p.createRequestOperation("subscription",e,r);return p.executeRequestOperation(t)},executeMutation(e,r){var t=p.createRequestOperation("mutation",e,r);return p.executeRequestOperation(t)},query:(e,r,t)=>(t&&"boolean"==typeof t.suspense||(t={...t,suspense:!1}),U(p.executeQuery(v(e,r),t))),readQuery(e,r,t){var n=null;return x((e=>{n=e}))(p.query(e,r,t)).unsubscribe(),n},subscription:(e,r,t)=>p.executeSubscription(v(e,r),t),mutation:(e,r,t)=>U(p.executeMutation(v(e,r),t))}),f=$,m=ie(void 0!==r.exchanges?r.exchanges:ue),h=w(m({client:p,dispatchDebug:f,forward:ae({dispatchDebug:f})})(s));return D(h),p},le=ce;export{ce as Client,K as cacheExchange,ie as composeExchanges,le as createClient,re as debugExchange,te as dedupExchange,ue as defaultExchanges,se as errorExchange,oe as fallbackExchangeIO,ne as fetchExchange,J as formatDocument,B as gql,V as makeOperation,G as maskTypename,Z as ssrExchange,ee as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
